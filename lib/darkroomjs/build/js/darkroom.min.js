!function(window,document,fabric){"use strict";function extend(b,a){var prop;if(void 0===b)return a;for(prop in a)a.hasOwnProperty(prop)&&b.hasOwnProperty(prop)===!1&&(b[prop]=a[prop]);return b}function Darkroom(element,options,plugins){return this.init(element,options,plugins)}function Plugin(darkroom,options){this.darkroom=darkroom,this.options=extend(options,this.defaults),this.initialize()}function Toolbar(element){this.element=element,this.actionsElement=element.querySelector(".darkroom-toolbar-actions")}function ButtonGroup(element){this.element=element}function Button(element){this.element=element}window.Darkroom=Darkroom,Darkroom.plugins=[],Plugin.prototype={defaults:{},initialize:function(){}},Plugin.extend=function(protoProps){var child,parent=this;child=protoProps&&protoProps.hasOwnProperty("constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},extend(child,parent);var Surrogate=function(){this.constructor=child};return Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,protoProps&&extend(child.prototype,protoProps),child.__super__=parent.prototype,child},Darkroom.Plugin=Plugin,Toolbar.prototype.createButtonGroup=function(){var buttonGroup=document.createElement("li");return buttonGroup.className="darkroom-button-group",this.actionsElement.appendChild(buttonGroup),new ButtonGroup(buttonGroup)},ButtonGroup.prototype.createButton=function(options){var defaults={image:"help",type:"default",group:"default",hide:!1,disabled:!1};options=extend(options,defaults);var button=document.createElement("button");button.className="darkroom-button darkroom-button-"+options.type,button.innerHTML='<i class="darkroom-icon-'+options.image+'"></i>',this.element.appendChild(button);var button=new Button(button);return button.hide(options.hide),button.disable(options.disabled),button},Button.prototype={addEventListener:function(eventName,callback){var el=this.element;el.addEventListener?el.addEventListener(eventName,callback):el.attachEvent&&el.attachEvent("on"+eventName,callback)},active:function(value){value?this.element.classList.add("darkroom-button-active"):this.element.classList.remove("darkroom-button-active")},hide:function(value){value?this.element.classList.add("darkroom-button-hidden"):this.element.classList.remove("darkroom-button-hidden")},disable:function(value){this.element.disabled=value?!0:!1}};var Canvas=fabric.util.createClass(fabric.Canvas,{});Darkroom.prototype={defaults:{minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,plugins:{},init:function(){}},addEventListener:function(eventName,callback){var el=this.canvas.getElement();el.addEventListener?el.addEventListener(eventName,callback):el.attachEvent&&el.attachEvent("on"+eventName,callback)},dispatchEvent:function(eventName){var event=document.createEvent("Event");event.initEvent(eventName,!0,!0),this.canvas.getElement().dispatchEvent(event)},init:function(element,options,plugins){var _this=this;if(this.isKeyCroping=!1,this.options=extend(options,this.defaults),"string"==typeof element&&(element=document.querySelector(element)),null!==element){plugins=plugins||Darkroom.plugins;var image=new Image;image.onload=function(){_this.createFabricImage(element).initDOM(element).initPlugins(plugins),_this.options.init.bind(_this).call()},image.src=element.src}},initDOM:function(element){var toolbar=document.createElement("div");toolbar.className="darkroom-toolbar",toolbar.innerHTML='<ul class="darkroom-toolbar-actions"></ul>';var canvas=document.createElement("canvas"),canvasContainer=document.createElement("div");canvasContainer.className="darkroom-image-container",canvasContainer.appendChild(canvas),this.container=document.createElement("div"),this.container.className="darkroom-container",this.container.appendChild(toolbar),this.container.appendChild(canvasContainer),this.options.replaceDom?element.parentNode.replaceChild(this.container,element):(this.originalImage=element,this.originalImage.style.display="none",element.parentNode.appendChild(this.container)),this.toolbar=new Toolbar(toolbar),this.canvas=new Canvas(canvas,{selection:!1,backgroundColor:"#ccc"});var width=this.image.getWidth(),height=this.image.getHeight();this.canvas.setWidth(this.image.getWidth()),this.canvas.setHeight(this.image.getHeight()),this.canvas.add(this.image),this.canvas.centerObject(this.image),this.image.setCoords();var _left=width/2,_top=height/2,me=this;this.scroller=new Scroller(function(left,top,zoom){_left-=left,_top-=top,me.image.setWidth(width/zoom),me.image.setHeight(height/zoom),me.canvas.moveObject(me.image,_left,_top),me.image.setCoords(),me.canvas.renderAll(),me.dispatchEvent("image:change")},{zooming:!0,animating:!1});var mousedown=!1;return canvasContainer.addEventListener("mousedown",function(e){e.target.tagName.match(/input|textarea|select/i)||me.isKeyCroping||(me.scroller.doTouchStart([{pageX:e.pageX,pageY:e.pageY}],e.timeStamp),mousedown=!0)},!1),document.addEventListener("mousemove",function(e){mousedown&&!me.isKeyCroping&&(me.scroller.doTouchMove([{pageX:e.pageX,pageY:e.pageY}],e.timeStamp),mousedown=!0)},!1),document.addEventListener("mouseup",function(e){mousedown&&(me.scroller.doTouchEnd(e.timeStamp),mousedown=!1)},!1),canvasContainer.addEventListener(navigator.userAgent.indexOf("Firefox")>-1?"DOMMouseScroll":"mousewheel",function(e){me.scroller.doMouseZoom(e.detail?-120*e.detail:e.wheelDelta,e.timeStamp,e.pageX,e.pageY)},!1),this},createFabricImage:function(imgElement){var width=imgElement.width,height=imgElement.height,scaleMin=1,scaleMax=1,scaleX=1,scaleY=1;null!==this.options.maxWidth&&this.options.maxWidth<width&&(scaleX=this.options.maxWidth/width),null!==this.options.maxHeight&&this.options.maxHeight<height&&(scaleY=this.options.maxHeight/height),scaleMin=Math.min(scaleX,scaleY),scaleX=1,scaleY=1,null!==this.options.minWidth&&this.options.minWidth>width&&(scaleX=this.options.minWidth/width),null!==this.options.minHeight&&this.options.minHeight>height&&(scaleY=this.options.minHeight/height),scaleMax=Math.max(scaleX,scaleY);var scale=scaleMax*scaleMin;return width*=scale,height*=scale,this.image=new fabric.Image(imgElement,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1}),this.image.setScaleX(scale),this.image.setScaleY(scale),this},initPlugins:function(plugins){this.plugins={};for(var name in plugins){var plugin=plugins[name],options=this.options.plugins[name];options!==!1&&(this.plugins[name]=new plugin(this,options))}},getPlugin:function(name){return this.plugins[name]},selfDestroy:function(){var container=this.container;if(this.originalImage)this.originalImage.src=this.snapshotImage(),this.originalImage.style.display=null,container.parentNode.removeChild(this.container);else{var image=new Image;image.onload=function(){container.parentNode.replaceChild(image,container)},image.id="ScannerImage",image.src=this.snapshotImage()}},snapshotImage:function(){return this.image.toDataURL()}}}(window,window.document,fabric),function(window,document,Darkroom,fabric){"use strict";Darkroom.plugins.history=Darkroom.Plugin.extend({initialize:function(){this._initButtons(),this.backHistoryStack=[],this.forwardHistoryStack=[],this._snapshotImage(),this.darkroom.addEventListener("image:change",this._onImageChange.bind(this))},goBack:function(){0!==this.backHistoryStack.length&&(this.forwardHistoryStack.push(this.currentImage),this.currentImage=this.backHistoryStack.pop(),this._applyImage(this.currentImage),this._updateButtons())},goForward:function(){0!==this.forwardHistoryStack.length&&(this.backHistoryStack.push(this.currentImage),this.currentImage=this.forwardHistoryStack.pop(),this._applyImage(this.currentImage),this._updateButtons())},_initButtons:function(){var buttonGroup=this.darkroom.toolbar.createButtonGroup();return this.backButton=buttonGroup.createButton({image:"back",disabled:!0}),this.forwardButton=buttonGroup.createButton({image:"forward",disabled:!0}),this.backButton.addEventListener("click",this.goBack.bind(this)),this.forwardButton.addEventListener("click",this.goForward.bind(this)),this},_updateButtons:function(){this.backButton.disable(0===this.backHistoryStack.length),this.forwardButton.disable(0===this.forwardHistoryStack.length)},_snapshotImage:function(){var image=new Image;image.src=this.darkroom.snapshotImage(),this.currentImage=image},_onImageChange:function(){this.backHistoryStack.push(this.currentImage),this._snapshotImage(),this.forwardHistoryStack.length=0,this._updateButtons()},_applyImage:function(image){var canvas=this.darkroom.canvas,imgInstance=new fabric.Image(image,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1});canvas.setWidth(image.width),canvas.setHeight(image.height),this.darkroom.image.remove(),this.darkroom.image=imgInstance,canvas.add(imgInstance)}})}(window,document,Darkroom,fabric),function(window,document,Darkroom){"use strict";Darkroom.plugins.rotate=Darkroom.Plugin.extend({initialize:function(){var buttonGroup=this.darkroom.toolbar.createButtonGroup();this.leftButton=buttonGroup.createButton({image:"rotate-left"}),this.rightButton=buttonGroup.createButton({image:"rotate-right"}),this.leftButton.addEventListener("click",this.rotateLeft.bind(this)),this.rightButton.addEventListener("click",this.rotateRight.bind(this))},rotateLeft:function(){this.rotate(-90)},rotateRight:function(){this.rotate(90)},rotate:function(angle){var darkroom=this.darkroom,canvas=darkroom.canvas,image=darkroom.image;angle=(image.getAngle()+angle)%360;var width,height;Math.abs(angle)%180?(height=image.getWidth(),width=image.getHeight()):(width=image.getWidth(),height=image.getHeight()),canvas.setWidth(width),canvas.setHeight(height),image.rotate(angle),canvas.centerObject(image),image.setCoords(),canvas.renderAll(),darkroom.dispatchEvent("image:change")}})}(window,document,Darkroom,fabric),function(window,document,Darkroom){"use strict";Darkroom.plugins.zoom=Darkroom.Plugin.extend({initialize:function(){var buttonGroup=this.darkroom.toolbar.createButtonGroup();this.zoomOutButton=buttonGroup.createButton({image:"zoom-out"}),this.zoomInButton=buttonGroup.createButton({image:"zoom-in"}),this.zoomOutButton.addEventListener("click",this.zoomOutLeft.bind(this)),this.zoomInButton.addEventListener("click",this.zoomInRight.bind(this))},zoomOutLeft:function(){this.zoom(!1)},zoomInRight:function(){this.zoom(!0)},zoom:function(zoom_in){var darkroom=this.darkroom,canvas=darkroom.canvas,image=darkroom.image;zoom_in?darkroom.scroller.zoomBy(.8,!0):darkroom.scroller.zoomBy(1.2,!0),canvas.centerObject(image),image.setCoords(),canvas.renderAll(),darkroom.dispatchEvent("image:change")}})}(window,document,Darkroom,fabric),function(window,document,Darkroom,fabric){"use strict";var CropZone=fabric.util.createClass(fabric.Rect,{_render:function(ctx){this.callSuper("_render",ctx);var dashWidth=(ctx.canvas,7),flipX=this.flipX?-1:1,flipY=this.flipY?-1:1,scaleX=flipX/this.scaleX,scaleY=flipY/this.scaleY;ctx.scale(scaleX,scaleY),ctx.fillStyle="rgba(0, 0, 0, 0.5)",this._renderOverlay(ctx),void 0!==ctx.setLineDash?ctx.setLineDash([dashWidth,dashWidth]):void 0!==ctx.mozDash&&(ctx.mozDash=[dashWidth,dashWidth]),ctx.strokeStyle="rgba(0, 0, 0, 0.2)",this._renderBorders(ctx),this._renderGrid(ctx),ctx.lineDashOffset=dashWidth,ctx.strokeStyle="rgba(255, 255, 255, 0.4)",this._renderBorders(ctx),this._renderGrid(ctx),ctx.scale(1/scaleX,1/scaleY)},_renderOverlay:function(ctx){var canvas=ctx.canvas,borderOffset=0,x0=Math.ceil(-this.getWidth()/2-this.getLeft()),x1=Math.ceil(-this.getWidth()/2),x2=Math.ceil(this.getWidth()/2),x3=Math.ceil(this.getWidth()/2+(canvas.width-this.getWidth()-this.getLeft())),y0=Math.ceil(-this.getHeight()/2-this.getTop()),y1=Math.ceil(-this.getHeight()/2),y2=Math.ceil(this.getHeight()/2),y3=Math.ceil(this.getHeight()/2+(canvas.height-this.getHeight()-this.getTop()));ctx.fillRect(x0,y0,x3-x0,y1-y0+borderOffset),ctx.fillRect(x0,y1,x1-x0,y2-y1+borderOffset),ctx.fillRect(x2,y1,x3-x2,y2-y1+borderOffset),ctx.fillRect(x0,y2,x3-x0,y3-y2)},_renderBorders:function(ctx){ctx.beginPath(),ctx.moveTo(-this.getWidth()/2,-this.getHeight()/2),ctx.lineTo(this.getWidth()/2,-this.getHeight()/2),ctx.lineTo(this.getWidth()/2,this.getHeight()/2),ctx.lineTo(-this.getWidth()/2,this.getHeight()/2),ctx.lineTo(-this.getWidth()/2,-this.getHeight()/2),ctx.stroke()},_renderGrid:function(ctx){ctx.beginPath(),ctx.moveTo(-this.getWidth()/2+1/3*this.getWidth(),-this.getHeight()/2),ctx.lineTo(-this.getWidth()/2+1/3*this.getWidth(),this.getHeight()/2),ctx.stroke(),ctx.beginPath(),ctx.moveTo(-this.getWidth()/2+2/3*this.getWidth(),-this.getHeight()/2),ctx.lineTo(-this.getWidth()/2+2/3*this.getWidth(),this.getHeight()/2),ctx.stroke(),ctx.beginPath(),ctx.moveTo(-this.getWidth()/2,-this.getHeight()/2+1/3*this.getHeight()),ctx.lineTo(this.getWidth()/2,-this.getHeight()/2+1/3*this.getHeight()),ctx.stroke(),ctx.beginPath(),ctx.moveTo(-this.getWidth()/2,-this.getHeight()/2+2/3*this.getHeight()),ctx.lineTo(this.getWidth()/2,-this.getHeight()/2+2/3*this.getHeight()),ctx.stroke()}});Darkroom.plugins.crop=Darkroom.Plugin.extend({startX:null,startY:null,isKeyCroping:!1,isKeyLeft:!1,isKeyUp:!1,defaults:{minHeight:1,minWidth:1,ratio:null,quickCropKey:!1},initialize:function(){var buttonGroup=this.darkroom.toolbar.createButtonGroup();this.cropButton=buttonGroup.createButton({image:"crop"}),this.okButton=buttonGroup.createButton({image:"accept",type:"success",hide:!0}),this.cancelButton=buttonGroup.createButton({image:"cancel",type:"danger",hide:!0}),this.cropButton.addEventListener("click",this.toggleCrop.bind(this)),this.okButton.addEventListener("click",this.cropCurrentZone.bind(this)),this.cancelButton.addEventListener("click",this.releaseFocus.bind(this)),this.darkroom.canvas.on("mouse:down",this.onMouseDown.bind(this)),this.darkroom.canvas.on("mouse:move",this.onMouseMove.bind(this)),this.darkroom.canvas.on("mouse:up",this.onMouseUp.bind(this)),this.darkroom.canvas.on("object:moving",this.onObjectMoving.bind(this)),this.darkroom.canvas.on("object:scaling",this.onObjectScaling.bind(this)),fabric.util.addListener(fabric.document,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(fabric.document,"keyup",this.onKeyUp.bind(this)),this.darkroom.addEventListener("image:change",this.releaseFocus.bind(this))},onObjectMoving:function(event){if(this.hasFocus()){var currentObject=event.target;if(currentObject===this.cropZone){var canvas=this.darkroom.canvas,x=currentObject.getLeft(),y=currentObject.getTop(),w=currentObject.getWidth(),h=currentObject.getHeight(),maxX=canvas.getWidth()-w,maxY=canvas.getHeight()-h;0>x&&currentObject.set("left",0),0>y&&currentObject.set("top",0),x>maxX&&currentObject.set("left",maxX),y>maxY&&currentObject.set("top",maxY),this.darkroom.dispatchEvent("crop:update")}}},onObjectScaling:function(event){if(this.hasFocus()){var preventScaling=!1,currentObject=event.target;if(currentObject===this.cropZone){var canvas=this.darkroom.canvas,pointer=canvas.getPointer(event.e),minX=(pointer.x,pointer.y,currentObject.getLeft()),minY=currentObject.getTop(),maxX=currentObject.getLeft()+currentObject.getWidth(),maxY=currentObject.getTop()+currentObject.getHeight();if(null!==this.options.ratio&&(0>minX||maxX>canvas.getWidth()||0>minY||maxY>canvas.getHeight())&&(preventScaling=!0),0>minX||maxX>canvas.getWidth()||preventScaling){var lastScaleX=this.lastScaleX||1;currentObject.setScaleX(lastScaleX)}if(0>minX&&currentObject.setLeft(0),0>minY||maxY>canvas.getHeight()||preventScaling){var lastScaleY=this.lastScaleY||1;currentObject.setScaleY(lastScaleY)}0>minY&&currentObject.setTop(0),currentObject.getWidth()<this.options.minWidth&&currentObject.scaleToWidth(this.options.minWidth),currentObject.getHeight()<this.options.minHeight&&currentObject.scaleToHeight(this.options.minHeight),this.lastScaleX=currentObject.getScaleX(),this.lastScaleY=currentObject.getScaleY(),this.darkroom.dispatchEvent("crop:update")}}},onMouseDown:function(event){if(this.hasFocus()){var canvas=this.darkroom.canvas;canvas.calcOffset();var pointer=canvas.getPointer(event.e),x=pointer.x,y=pointer.y,point=new fabric.Point(x,y),activeObject=canvas.getActiveObject();activeObject===this.cropZone||this.cropZone.containsPoint(point)||(canvas.discardActiveObject(),this.cropZone.setWidth(0),this.cropZone.setHeight(0),this.cropZone.setScaleX(1),this.cropZone.setScaleY(1),this.startX=x,this.startY=y)}},onMouseMove:function(event){if(this.isKeyCroping)return this.onMouseMoveKeyCrop(event);if(null!==this.startX&&null!==this.startY){var canvas=this.darkroom.canvas,pointer=canvas.getPointer(event.e),x=pointer.x,y=pointer.y;this._renderCropZone(this.startX,this.startY,x,y)}},onMouseMoveKeyCrop:function(event){var canvas=this.darkroom.canvas,zone=this.cropZone,pointer=canvas.getPointer(event.e),x=pointer.x,y=pointer.y;zone.left&&zone.top||(zone.setTop(y),zone.setLeft(x)),this.isKeyLeft=x<zone.left+zone.width/2,this.isKeyUp=y<zone.top+zone.height/2,this._renderCropZone(Math.min(zone.left,x),Math.min(zone.top,y),Math.max(zone.left+zone.width,x),Math.max(zone.top+zone.height,y))},onMouseUp:function(){if(null!==this.startX&&null!==this.startY){var canvas=this.darkroom.canvas;this.cropZone.setCoords(),canvas.setActiveObject(this.cropZone),canvas.calcOffset(),this.startX=null,this.startY=null}},onKeyDown:function(event){!1===this.options.quickCropKey||event.keyCode!==this.options.quickCropKey||this.isKeyCroping||(this.isKeyCroping=!0,this.darkroom.canvas.discardActiveObject(),this.cropZone.setWidth(0),this.cropZone.setHeight(0),this.cropZone.setScaleX(1),this.cropZone.setScaleY(1),this.cropZone.setTop(0),this.cropZone.setLeft(0))},onKeyUp:function(event){!1!==this.options.quickCropKey&&event.keyCode===this.options.quickCropKey&&this.isKeyCroping&&(this.isKeyCroping=!1,this.startX=1,this.startY=1,this.onMouseUp())},selectZone:function(x,y,width,height,forceDimension){this.hasFocus()||this.requireFocus(),forceDimension?this.cropZone.set({left:x,top:y,width:width,height:height}):this._renderCropZone(x,y,x+width,y+height);var canvas=this.darkroom.canvas;canvas.bringToFront(this.cropZone),this.cropZone.setCoords(),canvas.setActiveObject(this.cropZone),canvas.calcOffset(),this.darkroom.dispatchEvent("crop:update")},toggleCrop:function(){this.hasFocus()?this.releaseFocus():this.requireFocus()},cropCurrentZone:function(){if(this.hasFocus()&&!(this.cropZone.width<1&&this.cropZone.height<1)){var _this=this,darkroom=this.darkroom,canvas=darkroom.canvas;this.cropZone.visible=!1;var image=new Image;image.onload=function(){if(!(this.height<1||this.width<1)){var imgInstance=new fabric.Image(this,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1}),width=this.width,height=this.height;canvas.setWidth(width),canvas.setHeight(height),_this.darkroom.image.remove(),_this.darkroom.image=imgInstance,canvas.add(imgInstance),darkroom.dispatchEvent("image:change")}},image.src=canvas.toDataURL({left:this.cropZone.getLeft(),top:this.cropZone.getTop(),width:this.cropZone.getWidth(),height:this.cropZone.getHeight()})}},hasFocus:function(){return void 0!==this.cropZone},requireFocus:function(){this.cropZone=new CropZone({fill:"transparent",hasBorders:!1,originX:"left",originY:"top",cornerColor:"#444",cornerSize:8,transparentCorners:!1,lockRotation:!0,hasRotatingPoint:!1}),this.darkroom.isKeyCroping=!0,null!==this.options.ratio&&this.cropZone.set("lockUniScaling",!0),this.darkroom.canvas.add(this.cropZone),this.darkroom.canvas.defaultCursor="crosshair",this.cropButton.active(!0),this.okButton.hide(!1),this.cancelButton.hide(!1)},releaseFocus:function(){this.darkroom.isKeyCroping=!1,void 0!==this.cropZone&&(this.cropZone.remove(),this.cropZone=void 0,this.cropButton.active(!1),this.okButton.hide(!0),this.cancelButton.hide(!0),this.darkroom.canvas.defaultCursor="default",this.darkroom.dispatchEvent("crop:update"))},_renderCropZone:function(fromX,fromY,toX,toY){var canvas=this.darkroom.canvas,isRight=toX>fromX,isLeft=!isRight,isDown=toY>fromY,isUp=!isDown,minWidth=Math.min(+this.options.minWidth,canvas.getWidth()),minHeight=Math.min(+this.options.minHeight,canvas.getHeight()),leftX=Math.min(fromX,toX),rightX=Math.max(fromX,toX),topY=Math.min(fromY,toY),bottomY=Math.max(fromY,toY);leftX=Math.max(0,leftX),rightX=Math.min(canvas.getWidth(),rightX),topY=Math.max(0,topY),bottomY=Math.min(canvas.getHeight(),bottomY),minWidth>rightX-leftX&&(isRight?rightX=leftX+minWidth:leftX=rightX-minWidth),minHeight>bottomY-topY&&(isDown?bottomY=topY+minHeight:topY=bottomY-minHeight),0>leftX&&(rightX+=Math.abs(leftX),leftX=0),rightX>canvas.getWidth()&&(leftX-=rightX-canvas.getWidth(),rightX=canvas.getWidth()),0>topY&&(bottomY+=Math.abs(topY),topY=0),bottomY>canvas.getHeight()&&(topY-=bottomY-canvas.getHeight(),bottomY=canvas.getHeight());var width=rightX-leftX,height=bottomY-topY,currentRatio=width/height;if(this.options.ratio&&+this.options.ratio!==currentRatio){var ratio=+this.options.ratio;if(this.isKeyCroping&&(isLeft=this.isKeyLeft,isUp=this.isKeyUp),ratio>currentRatio){var newWidth=height*ratio;isLeft&&(leftX-=newWidth-width),width=newWidth}else if(currentRatio>ratio){var newHeight=height/(ratio*height/width);isUp&&(topY-=newHeight-height),height=newHeight}if(0>leftX&&(leftX=0),0>topY&&(topY=0),leftX+width>canvas.getWidth()){var newWidth=canvas.getWidth()-leftX;height=newWidth*height/width,width=newWidth,isUp&&(topY=fromY-height)}if(topY+height>canvas.getHeight()){var newHeight=canvas.getHeight()-topY;width=width*newHeight/height,height=newHeight,isLeft&&(leftX=fromX-width)}}this.cropZone.left=leftX,this.cropZone.top=topY,this.cropZone.width=width,this.cropZone.height=height,this.darkroom.canvas.bringToFront(this.cropZone),this.darkroom.dispatchEvent("crop:update")}})}(window,document,Darkroom,fabric),function(window,document,Darkroom){"use strict";Darkroom.plugins.save=Darkroom.Plugin.extend({defaults:{callback:function(){this.darkroom.selfDestroy(),"object"==typeof this.darkroom.options.save&&this.darkroom.options.save.callback&&this.darkroom.options.save.callback.bind(this)}},initialize:function(){if(this.darkroom.options.save!==!1){var buttonGroup=this.darkroom.toolbar.createButtonGroup();this.destroyButton=buttonGroup.createButton({image:"save"}),this.destroyButton.addEventListener("click",this.options.callback.bind(this))}}})}(window,document,Darkroom),function(global){var time=Date.now||function(){return+new Date},desiredFrames=60,millisecondsPerSecond=1e3,running={},counter=1;global.core?core.effect||(core.effect={}):global.core={effect:{}},core.effect.Animate={requestAnimationFrame:function(){var requestFrame=global.requestAnimationFrame||global.webkitRequestAnimationFrame||global.mozRequestAnimationFrame||global.oRequestAnimationFrame,isNative=!!requestFrame;if(requestFrame&&!/requestAnimationFrame\(\)\s*\{\s*\[native code\]\s*\}/i.test(requestFrame.toString())&&(isNative=!1),isNative)return function(callback,root){requestFrame(callback,root)};var TARGET_FPS=60,requests={},requestCount=0,rafHandle=1,intervalHandle=null,lastActive=+new Date;return function(callback){var callbackHandle=rafHandle++;return requests[callbackHandle]=callback,requestCount++,null===intervalHandle&&(intervalHandle=setInterval(function(){var time=+new Date,currentRequests=requests;requests={},requestCount=0;for(var key in currentRequests)currentRequests.hasOwnProperty(key)&&(currentRequests[key](time),lastActive=time);time-lastActive>2500&&(clearInterval(intervalHandle),intervalHandle=null)},1e3/TARGET_FPS)),callbackHandle}}(),stop:function(id){var cleared=null!=running[id];return cleared&&(running[id]=null),cleared},isRunning:function(id){return null!=running[id]},start:function(stepCallback,verifyCallback,completedCallback,duration,easingMethod,root){var start=time(),lastFrame=start,percent=0,dropCounter=0,id=counter++;if(root||(root=document.body),id%20===0){var newRunning={};for(var usedId in running)newRunning[usedId]=!0;running=newRunning}var step=function(virtual){var render=virtual!==!0,now=time();if(!running[id]||verifyCallback&&!verifyCallback(id))return running[id]=null,void(completedCallback&&completedCallback(desiredFrames-dropCounter/((now-start)/millisecondsPerSecond),id,!1));if(render)for(var droppedFrames=Math.round((now-lastFrame)/(millisecondsPerSecond/desiredFrames))-1,j=0;j<Math.min(droppedFrames,4);j++)step(!0),dropCounter++;duration&&(percent=(now-start)/duration,percent>1&&(percent=1));var value=easingMethod?easingMethod(percent):percent;stepCallback(value,now,render)!==!1&&1!==percent||!render?render&&(lastFrame=now,core.effect.Animate.requestAnimationFrame(step,root)):(running[id]=null,completedCallback&&completedCallback(desiredFrames-dropCounter/((now-start)/millisecondsPerSecond),id,1===percent||null==duration))};return running[id]=!0,core.effect.Animate.requestAnimationFrame(step,root),id}}}(this);var EasyScroller=function(content,options){this.content=content,this.container=content.parentNode,this.options=options||{};var that=this;this.scroller=new Scroller(function(left,top,zoom){that.render(left,top,zoom)},options),this.bindEvents(),this.content.style[EasyScroller.vendorPrefix+"TransformOrigin"]="left top",this.reflow()};EasyScroller.prototype.render=function(){var engine,docStyle=document.documentElement.style;window.opera&&"[object Opera]"===Object.prototype.toString.call(opera)?engine="presto":"MozAppearance"in docStyle?engine="gecko":"WebkitAppearance"in docStyle?engine="webkit":"string"==typeof navigator.cpuClass&&(engine="trident");var undef,vendorPrefix=EasyScroller.vendorPrefix={trident:"ms",gecko:"Moz",webkit:"Webkit",presto:"O"}[engine],helperElem=document.createElement("div"),perspectiveProperty=vendorPrefix+"Perspective",transformProperty=vendorPrefix+"Transform";return helperElem.style[perspectiveProperty]!==undef?function(left,top,zoom){this.content.style[transformProperty]="translate3d("+-left+"px,"+-top+"px,0) scale("+zoom+")"}:helperElem.style[transformProperty]!==undef?function(left,top,zoom){this.content.style[transformProperty]="translate("+-left+"px,"+-top+"px) scale("+zoom+")"}:function(left,top,zoom){this.content.style.marginLeft=left?-left/zoom+"px":"",this.content.style.marginTop=top?-top/zoom+"px":"",this.content.style.zoom=zoom||""}}(),EasyScroller.prototype.reflow=function(){this.scroller.setDimensions(this.container.clientWidth,this.container.clientHeight,this.content.offsetWidth,this.content.offsetHeight);var rect=this.container.getBoundingClientRect();this.scroller.setPosition(rect.left+this.container.clientLeft,rect.top+this.container.clientTop)},EasyScroller.prototype.bindEvents=function(){var that=this;if(window.addEventListener("resize",function(){that.reflow()},!1),"ontouchstart"in window)this.container.addEventListener("touchstart",function(e){e.touches[0]&&e.touches[0].target&&e.touches[0].target.tagName.match(/input|textarea|select/i)||(that.scroller.doTouchStart(e.touches,e.timeStamp),e.preventDefault())},!1),document.addEventListener("touchmove",function(e){that.scroller.doTouchMove(e.touches,e.timeStamp,e.scale)},!1),document.addEventListener("touchend",function(e){that.scroller.doTouchEnd(e.timeStamp)},!1),document.addEventListener("touchcancel",function(e){that.scroller.doTouchEnd(e.timeStamp)},!1);else{var mousedown=!1;this.container.addEventListener("mousedown",function(e){e.target.tagName.match(/input|textarea|select/i)||(that.scroller.doTouchStart([{pageX:e.pageX,pageY:e.pageY}],e.timeStamp),mousedown=!0,e.preventDefault())},!1),document.addEventListener("mousemove",function(e){mousedown&&(that.scroller.doTouchMove([{pageX:e.pageX,pageY:e.pageY}],e.timeStamp),mousedown=!0)},!1),document.addEventListener("mouseup",function(e){mousedown&&(that.scroller.doTouchEnd(e.timeStamp),mousedown=!1)},!1),this.container.addEventListener("mousewheel",function(e){that.options.zooming&&(that.scroller.doMouseZoom(e.wheelDelta,e.timeStamp,e.pageX,e.pageY),e.preventDefault())},!1)}},document.addEventListener("DOMContentLoaded",function(){for(var element,elements=document.querySelectorAll("[data-scrollable],[data-zoomable]"),i=0;i<elements.length;i++){element=elements[i];var scrollable=element.dataset.scrollable,zoomable=element.dataset.zoomable||"",zoomOptions=zoomable.split("-"),minZoom=zoomOptions.length>1&&parseFloat(zoomOptions[0]),maxZoom=zoomOptions.length>1&&parseFloat(zoomOptions[1]);new EasyScroller(element,{scrollingX:"true"===scrollable||"x"===scrollable,scrollingY:"true"===scrollable||"y"===scrollable,zooming:"true"===zoomable||zoomOptions.length>1,minZoom:minZoom,maxZoom:maxZoom})}},!1);var Scroller;!function(){var NOOP=function(){};Scroller=function(callback,options){this.__callback=callback,this.options={scrollingX:!0,scrollingY:!0,animating:!0,animationDuration:250,bouncing:!0,locking:!0,paging:!1,snapping:!1,zooming:!1,minZoom:.5,maxZoom:3,speedMultiplier:1,scrollingComplete:NOOP,penetrationDeceleration:.03,penetrationAcceleration:.08};for(var key in options)this.options[key]=options[key]};var easeOutCubic=function(pos){return Math.pow(pos-1,3)+1},easeInOutCubic=function(pos){return(pos/=.5)<1?.5*Math.pow(pos,3):.5*(Math.pow(pos-2,3)+2)},members={__isSingleTouch:!1,__isTracking:!1,__didDecelerationComplete:!1,__isGesturing:!1,__isDragging:!1,__isDecelerating:!1,__isAnimating:!1,__clientLeft:0,__clientTop:0,__clientWidth:0,__clientHeight:0,__contentWidth:0,__contentHeight:0,__snapWidth:100,__snapHeight:100,__refreshHeight:null,__refreshActive:!1,__refreshActivate:null,__refreshDeactivate:null,__refreshStart:null,__zoomLevel:1,__scrollLeft:0,__scrollTop:0,__maxScrollLeft:0,__maxScrollTop:0,__scheduledLeft:0,__scheduledTop:0,__scheduledZoom:0,__lastTouchLeft:null,__lastTouchTop:null,__lastTouchMove:null,__positions:null,__minDecelerationScrollLeft:null,__minDecelerationScrollTop:null,__maxDecelerationScrollLeft:null,__maxDecelerationScrollTop:null,__decelerationVelocityX:null,__decelerationVelocityY:null,setDimensions:function(clientWidth,clientHeight,contentWidth,contentHeight){var self=this;clientWidth===+clientWidth&&(self.__clientWidth=clientWidth),clientHeight===+clientHeight&&(self.__clientHeight=clientHeight),contentWidth===+contentWidth&&(self.__contentWidth=contentWidth),contentHeight===+contentHeight&&(self.__contentHeight=contentHeight),self.__computeScrollMax(),self.scrollTo(self.__scrollLeft,self.__scrollTop,!0)},setPosition:function(left,top){var self=this;self.__clientLeft=left||0,self.__clientTop=top||0},setSnapSize:function(width,height){var self=this;self.__snapWidth=width,self.__snapHeight=height},activatePullToRefresh:function(height,activateCallback,deactivateCallback,startCallback){var self=this;self.__refreshHeight=height,self.__refreshActivate=activateCallback,self.__refreshDeactivate=deactivateCallback,self.__refreshStart=startCallback},triggerPullToRefresh:function(){this.__publish(this.__scrollLeft,-this.__refreshHeight,this.__zoomLevel,!0),this.__refreshStart&&this.__refreshStart()},finishPullToRefresh:function(){var self=this;self.__refreshActive=!1,self.__refreshDeactivate&&self.__refreshDeactivate(),self.scrollTo(self.__scrollLeft,self.__scrollTop,!0)},getValues:function(){var self=this;return{left:self.__scrollLeft,top:self.__scrollTop,zoom:self.__zoomLevel}},getScrollMax:function(){var self=this;return{left:self.__maxScrollLeft,top:self.__maxScrollTop}},zoomTo:function(level,animate,originLeft,originTop,callback){var self=this;if(!self.options.zooming)throw new Error("Zooming is not enabled!");callback&&(self.__zoomComplete=callback),self.__isDecelerating&&(core.effect.Animate.stop(self.__isDecelerating),self.__isDecelerating=!1);var oldLevel=self.__zoomLevel;null==originLeft&&(originLeft=self.__clientWidth/2),null==originTop&&(originTop=self.__clientHeight/2),level=Math.max(Math.min(level,self.options.maxZoom),self.options.minZoom),self.__computeScrollMax(level);
var left=(originLeft+self.__scrollLeft)*level/oldLevel-originLeft,top=(originTop+self.__scrollTop)*level/oldLevel-originTop;left>self.__maxScrollLeft?left=self.__maxScrollLeft:0>left&&(left=0),top>self.__maxScrollTop?top=self.__maxScrollTop:0>top&&(top=0),self.__publish(left,top,level,animate)},zoomBy:function(factor,animate,originLeft,originTop,callback){var self=this;self.zoomTo(self.__zoomLevel*factor,animate,originLeft,originTop,callback)},scrollTo:function(left,top,animate,zoom){var self=this;if(self.__isDecelerating&&(core.effect.Animate.stop(self.__isDecelerating),self.__isDecelerating=!1),null!=zoom&&zoom!==self.__zoomLevel){if(!self.options.zooming)throw new Error("Zooming is not enabled!");left*=zoom,top*=zoom,self.__computeScrollMax(zoom)}else zoom=self.__zoomLevel;self.options.scrollingX?self.options.paging?left=Math.round(left/self.__clientWidth)*self.__clientWidth:self.options.snapping&&(left=Math.round(left/self.__snapWidth)*self.__snapWidth):left=self.__scrollLeft,self.options.scrollingY?self.options.paging?top=Math.round(top/self.__clientHeight)*self.__clientHeight:self.options.snapping&&(top=Math.round(top/self.__snapHeight)*self.__snapHeight):top=self.__scrollTop,left=Math.max(Math.min(self.__maxScrollLeft,left),0),top=Math.max(Math.min(self.__maxScrollTop,top),0),left===self.__scrollLeft&&top===self.__scrollTop&&(animate=!1),self.__publish(left,top,zoom,animate)},scrollBy:function(left,top,animate){var self=this,startLeft=self.__isAnimating?self.__scheduledLeft:self.__scrollLeft,startTop=self.__isAnimating?self.__scheduledTop:self.__scrollTop;self.scrollTo(startLeft+(left||0),startTop+(top||0),animate)},doMouseZoom:function(wheelDelta,timeStamp,pageX,pageY){var self=this,change=wheelDelta>0?.97:1.03;return self.zoomTo(self.__zoomLevel*change,!1,pageX-self.__clientLeft,pageY-self.__clientTop)},doTouchStart:function(touches,timeStamp){if(null==touches.length)throw new Error("Invalid touch list: "+touches);if(timeStamp instanceof Date&&(timeStamp=timeStamp.valueOf()),"number"!=typeof timeStamp)throw new Error("Invalid timestamp value: "+timeStamp);var self=this;self.__interruptedAnimation=!0,self.__isDecelerating&&(core.effect.Animate.stop(self.__isDecelerating),self.__isDecelerating=!1,self.__interruptedAnimation=!0),self.__isAnimating&&(core.effect.Animate.stop(self.__isAnimating),self.__isAnimating=!1,self.__interruptedAnimation=!0);var currentTouchLeft,currentTouchTop,isSingleTouch=1===touches.length;isSingleTouch?(currentTouchLeft=touches[0].pageX,currentTouchTop=touches[0].pageY):(currentTouchLeft=Math.abs(touches[0].pageX+touches[1].pageX)/2,currentTouchTop=Math.abs(touches[0].pageY+touches[1].pageY)/2),self.__initialTouchLeft=currentTouchLeft,self.__initialTouchTop=currentTouchTop,self.__zoomLevelStart=self.__zoomLevel,self.__lastTouchLeft=currentTouchLeft,self.__lastTouchTop=currentTouchTop,self.__lastTouchMove=timeStamp,self.__lastScale=1,self.__enableScrollX=!isSingleTouch&&self.options.scrollingX,self.__enableScrollY=!isSingleTouch&&self.options.scrollingY,self.__isTracking=!0,self.__didDecelerationComplete=!1,self.__isDragging=!isSingleTouch,self.__isSingleTouch=isSingleTouch,self.__positions=[]},doTouchMove:function(touches,timeStamp,scale){if(null==touches.length)throw new Error("Invalid touch list: "+touches);if(timeStamp instanceof Date&&(timeStamp=timeStamp.valueOf()),"number"!=typeof timeStamp)throw new Error("Invalid timestamp value: "+timeStamp);var self=this;if(self.__isTracking){var currentTouchLeft,currentTouchTop;2===touches.length?(currentTouchLeft=Math.abs(touches[0].pageX+touches[1].pageX)/2,currentTouchTop=Math.abs(touches[0].pageY+touches[1].pageY)/2):(currentTouchLeft=touches[0].pageX,currentTouchTop=touches[0].pageY);var positions=self.__positions;if(self.__isDragging){var moveX=currentTouchLeft-self.__lastTouchLeft,moveY=currentTouchTop-self.__lastTouchTop,scrollLeft=self.__scrollLeft,scrollTop=self.__scrollTop,level=self.__zoomLevel;if(null!=scale&&self.options.zooming){var oldLevel=level;if(level=level/self.__lastScale*scale,level=Math.max(Math.min(level,self.options.maxZoom),self.options.minZoom),oldLevel!==level){var currentTouchLeftRel=currentTouchLeft-self.__clientLeft,currentTouchTopRel=currentTouchTop-self.__clientTop;scrollLeft=(currentTouchLeftRel+scrollLeft)*level/oldLevel-currentTouchLeftRel,scrollTop=(currentTouchTopRel+scrollTop)*level/oldLevel-currentTouchTopRel,self.__computeScrollMax(level)}}if(self.__enableScrollX){scrollLeft-=moveX*this.options.speedMultiplier;var maxScrollLeft=self.__maxScrollLeft;(scrollLeft>maxScrollLeft||0>scrollLeft)&&(self.options.bouncing?scrollLeft+=moveX/2*this.options.speedMultiplier:scrollLeft=scrollLeft>maxScrollLeft?maxScrollLeft:0)}if(self.__enableScrollY){scrollTop-=moveY*this.options.speedMultiplier;var maxScrollTop=self.__maxScrollTop;(scrollTop>maxScrollTop||0>scrollTop)&&(self.options.bouncing?(scrollTop+=moveY/2*this.options.speedMultiplier,self.__enableScrollX||null==self.__refreshHeight||(!self.__refreshActive&&scrollTop<=-self.__refreshHeight?(self.__refreshActive=!0,self.__refreshActivate&&self.__refreshActivate()):self.__refreshActive&&scrollTop>-self.__refreshHeight&&(self.__refreshActive=!1,self.__refreshDeactivate&&self.__refreshDeactivate()))):scrollTop=scrollTop>maxScrollTop?maxScrollTop:0)}positions.length>60&&positions.splice(0,30),positions.push(scrollLeft,scrollTop,timeStamp),self.__publish(scrollLeft,scrollTop,level)}else{var minimumTrackingForScroll=self.options.locking?3:0,minimumTrackingForDrag=5,distanceX=Math.abs(currentTouchLeft-self.__initialTouchLeft),distanceY=Math.abs(currentTouchTop-self.__initialTouchTop);self.__enableScrollX=self.options.scrollingX&&distanceX>=minimumTrackingForScroll,self.__enableScrollY=self.options.scrollingY&&distanceY>=minimumTrackingForScroll,positions.push(self.__scrollLeft,self.__scrollTop,timeStamp),self.__isDragging=(self.__enableScrollX||self.__enableScrollY)&&(distanceX>=minimumTrackingForDrag||distanceY>=minimumTrackingForDrag),self.__isDragging&&(self.__interruptedAnimation=!1)}self.__lastTouchLeft=currentTouchLeft,self.__lastTouchTop=currentTouchTop,self.__lastTouchMove=timeStamp,self.__lastScale=scale}},doTouchEnd:function(timeStamp){if(timeStamp instanceof Date&&(timeStamp=timeStamp.valueOf()),"number"!=typeof timeStamp)throw new Error("Invalid timestamp value: "+timeStamp);var self=this;if(self.__isTracking){if(self.__isTracking=!1,self.__isDragging)if(self.__isDragging=!1,self.__isSingleTouch&&self.options.animating&&timeStamp-self.__lastTouchMove<=100){for(var positions=self.__positions,endPos=positions.length-1,startPos=endPos,i=endPos;i>0&&positions[i]>self.__lastTouchMove-100;i-=3)startPos=i;if(startPos!==endPos){var timeOffset=positions[endPos]-positions[startPos],movedLeft=self.__scrollLeft-positions[startPos-2],movedTop=self.__scrollTop-positions[startPos-1];self.__decelerationVelocityX=movedLeft/timeOffset*(1e3/60),self.__decelerationVelocityY=movedTop/timeOffset*(1e3/60);var minVelocityToStartDeceleration=self.options.paging||self.options.snapping?4:1;(Math.abs(self.__decelerationVelocityX)>minVelocityToStartDeceleration||Math.abs(self.__decelerationVelocityY)>minVelocityToStartDeceleration)&&(self.__refreshActive||self.__startDeceleration(timeStamp))}else self.options.scrollingComplete()}else timeStamp-self.__lastTouchMove>100&&self.options.scrollingComplete();self.__isDecelerating||(self.__refreshActive&&self.__refreshStart?(self.__publish(self.__scrollLeft,-self.__refreshHeight,self.__zoomLevel,!0),self.__refreshStart&&self.__refreshStart()):((self.__interruptedAnimation||self.__isDragging)&&self.options.scrollingComplete(),self.scrollTo(self.__scrollLeft,self.__scrollTop,!0,self.__zoomLevel),self.__refreshActive&&(self.__refreshActive=!1,self.__refreshDeactivate&&self.__refreshDeactivate()))),self.__positions.length=0}},__publish:function(left,top,zoom,animate){var self=this,wasAnimating=self.__isAnimating;if(wasAnimating&&(core.effect.Animate.stop(wasAnimating),self.__isAnimating=!1),animate&&self.options.animating){self.__scheduledLeft=left,self.__scheduledTop=top,self.__scheduledZoom=zoom;var oldLeft=self.__scrollLeft,oldTop=self.__scrollTop,oldZoom=self.__zoomLevel,diffLeft=left-oldLeft,diffTop=top-oldTop,diffZoom=zoom-oldZoom,step=function(percent,now,render){render&&(self.__scrollLeft=oldLeft+diffLeft*percent,self.__scrollTop=oldTop+diffTop*percent,self.__zoomLevel=oldZoom+diffZoom*percent,self.__callback&&self.__callback(self.__scrollLeft,self.__scrollTop,self.__zoomLevel))},verify=function(id){return self.__isAnimating===id},completed=function(renderedFramesPerSecond,animationId,wasFinished){animationId===self.__isAnimating&&(self.__isAnimating=!1),(self.__didDecelerationComplete||wasFinished)&&self.options.scrollingComplete(),self.options.zooming&&(self.__computeScrollMax(),self.__zoomComplete&&(self.__zoomComplete(),self.__zoomComplete=null))};self.__isAnimating=core.effect.Animate.start(step,verify,completed,self.options.animationDuration,wasAnimating?easeOutCubic:easeInOutCubic)}else self.__scheduledLeft=self.__scrollLeft=left,self.__scheduledTop=self.__scrollTop=top,self.__scheduledZoom=self.__zoomLevel=zoom,self.__callback&&self.__callback(left,top,zoom),self.options.zooming&&(self.__computeScrollMax(),self.__zoomComplete&&(self.__zoomComplete(),self.__zoomComplete=null))},__computeScrollMax:function(zoomLevel){var self=this;null==zoomLevel&&(zoomLevel=self.__zoomLevel),self.__maxScrollLeft=Math.max(self.__contentWidth*zoomLevel-self.__clientWidth,0),self.__maxScrollTop=Math.max(self.__contentHeight*zoomLevel-self.__clientHeight,0)},__startDeceleration:function(){var self=this;if(self.options.paging){var scrollLeft=Math.max(Math.min(self.__scrollLeft,self.__maxScrollLeft),0),scrollTop=Math.max(Math.min(self.__scrollTop,self.__maxScrollTop),0),clientWidth=self.__clientWidth,clientHeight=self.__clientHeight;self.__minDecelerationScrollLeft=Math.floor(scrollLeft/clientWidth)*clientWidth,self.__minDecelerationScrollTop=Math.floor(scrollTop/clientHeight)*clientHeight,self.__maxDecelerationScrollLeft=Math.ceil(scrollLeft/clientWidth)*clientWidth,self.__maxDecelerationScrollTop=Math.ceil(scrollTop/clientHeight)*clientHeight}else self.__minDecelerationScrollLeft=0,self.__minDecelerationScrollTop=0,self.__maxDecelerationScrollLeft=self.__maxScrollLeft,self.__maxDecelerationScrollTop=self.__maxScrollTop;var step=function(percent,now,render){self.__stepThroughDeceleration(render)},minVelocityToKeepDecelerating=self.options.snapping?4:.1,verify=function(){var shouldContinue=Math.abs(self.__decelerationVelocityX)>=minVelocityToKeepDecelerating||Math.abs(self.__decelerationVelocityY)>=minVelocityToKeepDecelerating;return shouldContinue||(self.__didDecelerationComplete=!0),shouldContinue},completed=function(){self.__isDecelerating=!1,self.__didDecelerationComplete&&self.options.scrollingComplete(),self.scrollTo(self.__scrollLeft,self.__scrollTop,self.options.snapping)};self.__isDecelerating=core.effect.Animate.start(step,verify,completed)},__stepThroughDeceleration:function(render){var self=this,scrollLeft=self.__scrollLeft+self.__decelerationVelocityX,scrollTop=self.__scrollTop+self.__decelerationVelocityY;if(!self.options.bouncing){var scrollLeftFixed=Math.max(Math.min(self.__maxDecelerationScrollLeft,scrollLeft),self.__minDecelerationScrollLeft);scrollLeftFixed!==scrollLeft&&(scrollLeft=scrollLeftFixed,self.__decelerationVelocityX=0);var scrollTopFixed=Math.max(Math.min(self.__maxDecelerationScrollTop,scrollTop),self.__minDecelerationScrollTop);scrollTopFixed!==scrollTop&&(scrollTop=scrollTopFixed,self.__decelerationVelocityY=0)}if(render?self.__publish(scrollLeft,scrollTop,self.__zoomLevel):(self.__scrollLeft=scrollLeft,self.__scrollTop=scrollTop),!self.options.paging){var frictionFactor=.95;self.__decelerationVelocityX*=frictionFactor,self.__decelerationVelocityY*=frictionFactor}if(self.options.bouncing){var scrollOutsideX=0,scrollOutsideY=0,penetrationDeceleration=self.options.penetrationDeceleration,penetrationAcceleration=self.options.penetrationAcceleration;scrollLeft<self.__minDecelerationScrollLeft?scrollOutsideX=self.__minDecelerationScrollLeft-scrollLeft:scrollLeft>self.__maxDecelerationScrollLeft&&(scrollOutsideX=self.__maxDecelerationScrollLeft-scrollLeft),scrollTop<self.__minDecelerationScrollTop?scrollOutsideY=self.__minDecelerationScrollTop-scrollTop:scrollTop>self.__maxDecelerationScrollTop&&(scrollOutsideY=self.__maxDecelerationScrollTop-scrollTop),0!==scrollOutsideX&&(scrollOutsideX*self.__decelerationVelocityX<=0?self.__decelerationVelocityX+=scrollOutsideX*penetrationDeceleration:self.__decelerationVelocityX=scrollOutsideX*penetrationAcceleration),0!==scrollOutsideY&&(scrollOutsideY*self.__decelerationVelocityY<=0?self.__decelerationVelocityY+=scrollOutsideY*penetrationDeceleration:self.__decelerationVelocityY=scrollOutsideY*penetrationAcceleration)}}};for(var key in members)Scroller.prototype[key]=members[key]}();
//# sourceMappingURL=darkroom.min.js.map